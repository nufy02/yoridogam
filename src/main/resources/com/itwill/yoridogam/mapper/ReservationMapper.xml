<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.itwill.yoridogam.mapper.ReservationMapper">

<resultMap type="com.itwill.yoridogam.reservation.Reservation" id="ReservationResultMap">
	<result column="REV_TOTAL" property="rsv_total"/>
	<result column="REV_TYPE" property="rsv_type"/>
	<result column="REV_QTY" property="rsv_qty"/>
	<result column="REV_DATE" property="rsv_date"/>
	<result column="REV_TIME" property="rsv_time"/>
	<association property="member" javaType="com.itwill.yoridogam.member.Member" autoMapping="true">
		<result column="M_ID" property="m_id"/>
	</association>
	<association property="product" javaType="com.itwill.yoridogam.product.Product" autoMapping="true">
		<result column="P_NO" property="p_no"/>
	</association>
</resultMap>

 
 <!-- 오프라인 강의예약 insert -->
<insert id="create" parameterType="com.itwill.yoridogam.reservation.Reservation">
 insert into reservation(rsv_no, rsv_total, rsv_type, rsv_qty, rsv_date, rsv_time, rsv_paydate, m_id, p_no)
values(RESERVATION_RSV_NO_SEQ.nextval,#{rsv_total},#{rsv_type},#{rsv_qty},to_date(#{rsv_date},'YYYY/MM/DD'),#{rsv_time},sysdate,#{member.m_id},#{product.p_no})
</insert>

<!--m_id 회원 예약 전체 조회-->
<select id="selectAll" parameterType="java.lang.String" resultMap="ReservationResultMap">
 select * from reservation where m_id=#{m_id}
</select>

<!--m_id 회원 예약 특정 상세 조회-->
<select id="selectAll" parameterType="com.itwill.yoridogam.reservation.Reservation" resultMap="ReservationResultMap">
select * from product p join reservation rsv on rsv.p_no=p.p_no where rsv.m_id=#{m_id}
</select>

<!-- m_id회원 특정 예약 삭제 -->
<delete id="deleteById" parameterType="com.itwill.yoridogam.reservation.Reservation">
delete from reservation where rsv_no=#{rsv_no} and m_id=#{m_id}
</delete>

<!-- m_id회원 전체 예약 삭제 -->
<delete id="deleteAll" parameterType="java.lang.String">
delete from reservation where m_id=#{m_id}
</delete>


</mapper>